{"version":3,"sources":["ButtonMicrosoft.jsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAIqB,e;;;AACnB,6BAAY,KAAZ,EAAkB;AAAA;;AAAA,oIACV,KADU;;AAGhB,UAAM,aAAa;AACjB,uBAAe,gBADE;AAEjB,mBAAc,MAAM,KAFH;AAGjB,sBAAc,MAAM,WAHH;AAIjB,eAAO,MAAM,KAJI;AAKjB,eAAO,iBALU;AAMjB,eAAO,iBANU;AAOjB,uBAAe;AAPE,OAAnB;;AAUA,UAAM,SAAS,OACZ,IADY,CACP,UADO,EAEZ,GAFY,CAER;AAAA,eAAQ,mBAAmB,CAAnB,CAAR,SAAiC,mBAAmB,WAAW,CAAX,CAAnB,CAAjC;AAAA,OAFQ,EAGZ,IAHY,CAGP,GAHO,CAAf;;AAKA,YAAK,KAAL,GAAa;AACX,qFAA4E,MADjE;AAEX,gBAAU;AAFC,OAAb;AAlBgB;AAsBjB;;;;8BAEO,C,EAAE;AAAA;;AACR,UAAE,cAAF;AACA,eAAO,IAAP,CAAY,KAAK,KAAL,CAAW,OAAvB,EAAgC,SAAhC,EAA2C,sBAA3C;;AAEA,eAAO,aAAP,GAAuB,aAAK;AAC1B,cAAI,SAAS,+BAAe,MAAf,CAAsB,IAAtB,CAA2B;AACtC,0BAAc;AAAA,qBAAQ,KAAK,IAAL,EAAW,EAAE,YAAb,CAAR;AAAA;AADwB,WAA3B,CAAb;AAGA,iBAAK,QAAL,CAAc,MAAd;AACA,iBAAO,aAAP,GAAuB,IAAvB;AACD,SAND;;AAQA,YAAG,CAAC,KAAK,KAAL,CAAW,OAAf,EAAuB;AACvB,aAAK,KAAL,CAAW,OAAX,CAAmB,CAAnB;AACD;;;+BAEQ,M,EAAO;AACd,eACG,GADH,CACO,KADP,EAEG,GAFH,CAEO,UAAC,GAAD,EAAM,GAAN;AAAA,iBAAc,QAAQ,GAAR,CAAY,IAAI,WAAhB,CAAd;AAAA,SAFP;;AAIA,YAAG,CAAC,KAAK,KAAL,CAAW,QAAf,EAAwB;AACxB,aAAK,QAAL,CAAc,MAAd;AACD;;;+BAEO;AACN,eAAQ;AAAA;AAAA,YAAK,SAAS,KAAK,OAAnB;AAAA;AAAA,SAAR;AACD;;;;IApD0C,gBAAM,S;;oBAA9B,e","file":"ButtonMicrosoft.js","sourcesContent":["import React from \"react\";\nimport MicrosoftGraph from '@microsoft/microsoft-graph-client';\nimport {uuid} from 'uuid';\n\nexport default class ButtonMicrosoft extends React.Component{\n  constructor(props){\n    super(props);\n\n    const authParams = {\n      response_type: 'id_token token',\n      client_id:    props.appId,\n      redirect_uri: props.redirectUri,\n      scope: props.scope,\n      state: uuid(),\n      nonce: uuid(),\n      response_mode: 'fragment'\n    };\n\n    const params = Object\n      .keys(authParams)\n      .map(k => `${encodeURIComponent(k)}=${encodeURIComponent(authParams[k])}`)\n      .join('&');\n\n    this.state = {\n      authURL : `https://login.microsoftonline.com/common/oauth2/v2.0/authorize?${params}`,\n      client  : null,\n    };\n  }\n\n  onClick(e){\n    e.preventDefault();\n    window.open(this.state.authURL, 'ms-auth', 'width=300,height:600');\n\n    window.msAuthHandler = x => {\n      let client = MicrosoftGraph.Client.init({\n        authProvider: done => done(null, x.access_token)\n      });\n      this.onSignIn(client);\n      window.msAuthHandler = null;\n    };\n\n    if(!this.props.onClick)return;\n    this.props.onClick(e);\n  }\n\n  onSignIn(client){\n    client\n      .api('/me')\n      .get((err, res) => console.log(res.displayName));\n\n    if(!this.props.onSignIn)return;\n    this.onSignIn(client);\n  }\n\n  render(){\n    return (<div onClick={this.onClick}>Microsoft 登入</div>);\n  }\n}"]}